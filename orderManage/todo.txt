1. (main.cpp:207-232) stop trusting market won't do something weird

2. Do two phase kafka write, stating intention then success.
